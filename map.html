<!DOCTYPE html><html lang='en'><head><meta charset='UTF-8'/><meta name='viewport' content='width=device-width,initial-scale=1'/><title>Map — Ionian Coast Explorer</title><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css'/><link rel='stylesheet' href='https://unpkg.com/leaflet@1.9.4/dist/leaflet.css'/><style>.wrap{max-width:1100px;margin:24px auto;padding:0 16px}#map{height:520px;border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.06)}</style></head><body><main class='wrap'><nav style='display:flex;align-items:center;justify-content:space-between'><strong>Map</strong><a href='index.html' class='secondary'>← Home</a></nav><div style='display:flex;gap:8px;flex-wrap:wrap;margin:12px 0'><select id='category'><option value='all'>All categories</option><option value='accommodation'>Accommodation</option><option value='boating'>Boating</option><option value='alternative'>Alternative</option><option value='coastal'>Coastal Life</option><option value='food'>Coastal Cuisine</option></select><select id='region'><option value='all'>All regions</option><option>Syvota</option><option>Paxi</option><option>Corfu South</option><option>Ionian</option></select><select id='price'><option value='all'>Any price</option><option>€</option><option>€€</option><option>€€€</option></select></div><div id='map'></div></main><script src='https://unpkg.com/leaflet@1.9.4/dist/leaflet.js'></script><script>let ALL=[],map,markers=[];function normalizeCategory(c){c=(c||'').toLowerCase();if(c.includes('boat'))return'boating';if(c.includes('accom'))return'accommodation';if(c.includes('coastal')||c.includes('fish'))return'coastal';if(c.includes('food')||c.includes('dine')||c.includes('rest'))return'food';return'alternative'}const colors={accommodation:'#4c78ff',boating:'#ff9a3c',alternative:'#2ecc71',coastal:'#ff6f61',food:'#a97bdc'}function readParams(){const u=new URL(location.href);['category','region','price'].forEach(id=>{const v=u.searchParams.get(id)||'all';const el=document.getElementById(id);if(el)el.value=v})}async function load(){return fetch('data/listings.json').then(r=>r.json())}function clear(){markers.forEach(m=>m.remove());markers=[]}function pinColor(cat){return colors[normalizeCategory(cat)]||'#7aa2ff'}function add(item){if(!item.lat||!item.lng)return;const icon=L.divIcon({className:'',html:`<div style='width:16px;height:16px;border-radius:50%;background:${pinColor(item.category)};border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,.2)'></div>`});const m=L.marker([item.lat,item.lng],{icon}).addTo(map);const price=item.priceCents?('From €'+(item.priceCents/100).toFixed(0)):(item.priceTier||'');const btn=(item.priceCents&&item.connectedAccountId)?`<a href='detail.html?id=${item.id}'>Book & Pay →</a>`:`<a class='secondary' href='detail.html?id=${item.id}'>View details →</a>`;m.bindPopup(`<strong>${item.title||'Listing'}</strong><br/>${item.region||''} • ${item.category||''}<br/><small>${price}</small><br/>${btn}`);markers.push(m)}function apply(){const c=document.getElementById('category').value,r=document.getElementById('region').value,p=document.getElementById('price').value;const items=ALL.filter(it=>(c==='all'||normalizeCategory(it.category)===c)&&(r==='all'||(it.region||'')===r)&&(p==='all'||(it.priceTier||'')===p));clear();items.forEach(add);if(items.length)map.setView([items[0].lat||39.35,items[0].lng||20.2],10)}(async function(){readParams();const data=await load();ALL=[...(data.categories||[]),...(data.marine||[])];map=L.map('map').setView([39.35,20.2],10);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);['category','region','price'].forEach(id=>document.getElementById(id).addEventListener('change',()=>{const u=new URL(location.href);const v=document.getElementById(id).value;if(v==='all')u.searchParams.delete(id);else u.searchParams.set(id,v);history.replaceState({},'',u);apply();}));apply();})()</script></body></html>